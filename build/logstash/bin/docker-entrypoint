#!/bin/bash -e

# Map environment variables to entries in logstash.yml.
# Note that this will mutate logstash.yml in place if any such settings are found.
# This may be undesirable, especially if logstash.yml is bind-mounted from the
# host system.
env2yaml /usr/share/logstash/config/logstash.yml

# Default to running logstash if no arguments are given, or if first argument
# starts with a -
if [[ -z $1 ]] || [[ ${1:0:1} == '-' ]] ; then
  set -- logstash "$@"
fi

# Change to the logstash user if we're running the logstash command, and
# not already running as an unprivileged user
if [ "$1" = 'logstash' -a "$(id -u)" = '0' ]; then
    set -- gosu logstash "$@"
fi

exec "$@"
